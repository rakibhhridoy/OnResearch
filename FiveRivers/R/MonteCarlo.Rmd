---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
# Load necessary libraries
library(ggplot2)   # For visualization
library(dplyr)
library(ggpubr)
library(cowplot)
require(ggExtra)
# For data manipulation

# 1. Define parameters for the simulation for each element
# Replace with actual mean and standard deviation values based on your data
data <- read.csv("../data/RI(winter).csv")

mean_CdW <- mean(data$CdW)   # Mean of CdW
sd_CdW <- sd(data$CdW)     # Standard deviation of CdW

mean_CrW <- mean(data$CrW)   # Mean of CrW
sd_CrW <- sd(data$CrW)     # Standard deviation of CrW

mean_NiW <- mean(data$NiW)   # Mean of NiW
sd_NiW <- sd(data$NiW)     # Standard deviation of NiW

mean_AsW <- mean(data$AsW)   # Mean of AsW
sd_AsW <- sd(data$AsW)     # Standard deviation of AsW

mean_PbW <- mean(data$PbW)   # Mean of PbW
sd_PbW <- sd(data$PbW)     # Standard deviation of PbW

mean_CuW <- mean(data$CuW)   # Mean of CuW
sd_CuW <- sd(data$CuW)     # Standard deviation of CuW

# Number of simulations
num_simulations <- 10000

# 2. Generate random samples for each element using normal distribution
CdW_sim <- rnorm(num_simulations, mean = mean_CdW, sd = sd_CdW)
CrW_sim <- rnorm(num_simulations, mean = mean_CrW, sd = sd_CrW)
NiW_sim <- rnorm(num_simulations, mean = mean_NiW, sd = sd_NiW)
AsW_sim <- rnorm(num_simulations, mean = mean_AsW, sd = sd_AsW)
PbW_sim <- rnorm(num_simulations, mean = mean_PbW, sd = sd_PbW)
CuW_sim <- rnorm(num_simulations, mean = mean_CuW, sd = sd_CuW)

# 3. Calculate the Risk Index for each simulation (sum of all elements)
Risk_Index_sim <- CdW_sim + CrW_sim + NiW_sim + AsW_sim + PbW_sim + CuW_sim

simulated_data_n <- data.frame(
  Cd = CdW_sim,
  Cr = CrW_sim,
  Ni = NiW_sim,
  As = AsW_sim,
  Pb = PbW_sim,
  Cu = CuW_sim,
  RI = Risk_Index_sim  # Add Risk Index as a separate column
)

simulated_data_n
```


```{r}
# Load necessary libraries
library(dplyr)     # For data manipulation

mu_CdW <- mean(log(data$CdW), na.rm = TRUE)   # Log-transformed mean of CdW
sigma_CdW <- sd(log(data$CdW), na.rm = TRUE)   # Log-transformed SD of CdW

mu_CrW <- mean(log(data$CrW), na.rm = TRUE)   # Log-transformed mean of CrW
sigma_CrW <- sd(log(data$CrW), na.rm = TRUE)   # Log-transformed SD of CrW

mu_NiW <- mean(log(data$NiW), na.rm = TRUE)   # Log-transformed mean of NiW
sigma_NiW <- sd(log(data$NiW), na.rm = TRUE)   # Log-transformed SD of NiW

mu_AsW <- mean(log(data$AsW), na.rm = TRUE)   # Log-transformed mean of AsW
sigma_AsW <- sd(log(data$AsW), na.rm = TRUE)   # Log-transformed SD of AsW

mu_PbW <- mean(log(data$PbW), na.rm = TRUE)   # Log-transformed mean of PbW
sigma_PbW <- sd(log(data$PbW), na.rm = TRUE)   # Log-transformed SD of PbW

mu_CuW <- mean(log(data$CuW), na.rm = TRUE)   # Log-transformed mean of CuW
sigma_CuW <- sd(log(data$CuW), na.rm = TRUE)   # Log-transformed SD of CuW

# Number of simulations
num_simulations <- 10000

# 3. Generate random samples for each element using log-normal distribution
CdW_sim <- rlnorm(num_simulations, meanlog = mu_CdW, sdlog = sigma_CdW)
CrW_sim <- rlnorm(num_simulations, meanlog = mu_CrW, sdlog = sigma_CrW)
NiW_sim <- rlnorm(num_simulations, meanlog = mu_NiW, sdlog = sigma_NiW)
AsW_sim <- rlnorm(num_simulations, meanlog = mu_AsW, sdlog = sigma_AsW)
PbW_sim <- rlnorm(num_simulations, meanlog = mu_PbW, sdlog = sigma_PbW)
CuW_sim <- rlnorm(num_simulations, meanlog = mu_CuW, sdlog = sigma_CuW)

# 4. Calculate the Risk Index for each simulation (sum of all elements)
Risk_Index_sim <- CdW_sim + CrW_sim + NiW_sim + AsW_sim + PbW_sim + CuW_sim

# 5. Create a data frame with each element and the Risk Index
simulated_data_l <- data.frame(
  Cd = CdW_sim,
  Cr = CrW_sim,
  Ni = NiW_sim,
  As = AsW_sim,
  Pb = PbW_sim,
  Cu = CuW_sim,
  RI = Risk_Index_sim  # Add Risk Index as a separate column
)

head(simulated_data_l)
```


```{r}
write.csv(simulated_data_n, "../data/MonteWinterNormal.csv")
write.csv(simulated_data_l, "../data/MonteWinterLogNormal.csv")
```


```{r}
rinormA <- simulated_data_n
log_normalRI <- simulated_data_l
```


```{r}
phist <- gghistogram(
  rinormA, x = "RI", 
  add = "mean", rug = TRUE, bins = 100,
  fill = "#00AFBB", # Set histogram fill color
  color = "black" # Set border color
) +
#  xlim(NA, 100) +
  xlab(label = "Ecological Risk Index (RI)") +
  ylab("Frequency") 

# 2. Create the density plot with y-axis on the right
pdensity <- ggdensity(
  rinormA, x = "RI",
  fill = "cyan", # Set density fill color
  color = "orange",  # Set density line color
  alpha = 0.2 # Set transparency level
) +
#  xlim(NA, 100) +
  ylab("Density") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), position = "right") +
  theme_half_open(11, rel_small = 1) +
  rremove("x.axis") +
  rremove("xlab") +
  rremove("x.text") +
  rremove("x.ticks") +
  rremove("legend")

# 3. Align the two plots and then overlay them
aligned_plots <- align_plots(phist, pdensity, align = "hv", axis = "tblr")

p <- ggdraw(aligned_plots[[1]]) + 
     draw_plot(aligned_plots[[2]]) + 
     draw_label("Normal Distribution", 
                fontface = "bold", size = 12, x = 0.75, y = .97, vjust = 1)
p

```


```{r}
phist <- gghistogram(
  log_normalRI, x = "RI", 
  add = "mean", rug = TRUE, bins = 100,
  fill = "Legend", # Set histogram fill color
  color = "black" # Set border color
) +
#  xlim(NA, 100) +
  xlab(label = "Ecological Risk Index (RI)") +
  ylab("Frequency") +
  theme_minimal()  # Optional: Change theme for better visuals

# 2. Create the density plot with y-axis on the right
pdensity <- ggdensity(
  log_normalRI, x = "RI",
  fill = "Legend", # Set density fill color
  color = "black",  # Set density line color
  alpha = 0.5 # Set transparency level
) +
#  xlim(NA, 100) +
  ylab("Density") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)), position = "right") +
  theme_half_open(11, rel_small = 1) +
  rremove("x.axis") +
  rremove("xlab") +
  rremove("x.text") +
  rremove("x.ticks") +
  rremove("legend")

# 3. Align the two plots and then overlay them
aligned_plots <- align_plots(phist, pdensity, align = "hv", axis = "tblr")
ggdraw(aligned_plots[[1]]) + draw_plot(aligned_plots[[2]])
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

